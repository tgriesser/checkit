<!DOCTYPE html>

<html>
<head>
  <title>checkit.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>checkit.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <pre><code>Checkit.js 0.2.0
http://tgriesser.com/checkit
(c) 2013 Tim Griesser
Checkit may be freely distributed under the MIT license.</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="keyword">function</span>(factory) {

<span class="string">"use strict"</span>;

factory(<span class="keyword">function</span>(_, createError, Promise) {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>The top level <code>Checkit</code> constructor, accepting the
<code>validations</code> to be run and any (optional) <code>options</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> Checkit = <span class="keyword">function</span>(validations, options) {
    <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> Checkit)) {
      <span class="keyword">return</span> <span class="keyword">new</span> Checkit(validations, options);
    }
    options = _.clone(options || {});
    <span class="keyword">this</span>.conditional = [];
    <span class="keyword">this</span>.language    = options.language;
    <span class="keyword">this</span>.labels      = options.labels || {};
    <span class="keyword">this</span>.messages    = options.messages || {};
    <span class="keyword">this</span>.validations = prepValidations(validations || {});
  };

  Checkit.VERSION = <span class="string">'0.2.0'</span>;

  Checkit.prototype = {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Possibly run a validations on this object, depending on the
result of the <code>conditional</code> handler.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    maybe: <span class="keyword">function</span>(validations, conditional) {
      <span class="keyword">this</span>.conditional.push([prepValidations(validations), conditional]);
      <span class="keyword">return</span> <span class="keyword">this</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Asynchronously runs a validation block, returning a promise
which resolves with the validated object items, or is rejected
with a <code>Checkit.Error</code> instance.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    run: <span class="keyword">function</span>(target) {
      <span class="keyword">return</span> <span class="keyword">new</span> Checkit.Runner(<span class="keyword">this</span>).run(target);
    }

  };</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>The default language for all validations, defaults to &quot;en&quot; which
is included with the library by default. To add additional languages,
add them to the <code>Checkit.i18n</code> object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Checkit.language = <span class="string">'en'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Runs validation on an individual rule &amp; value, for convenience.
e.g. <code>Checkit.check(&#39;email&#39;, &#39;foo@domain&#39;, &#39;email&#39;).then(...</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Checkit.check = <span class="keyword">function</span>(key, value, rules) {
    <span class="keyword">var</span> input = {}, validations = {};
    input[key] = value;
    validations[key] = rules;
    <span class="keyword">return</span> <span class="keyword">new</span> Checkit(validations).run(input).then(<span class="literal">null</span>, <span class="keyword">function</span>(err) {
      <span class="keyword">if</span> (err <span class="keyword">instanceof</span> Checkit.Error) <span class="keyword">throw</span> err.get(key);
      <span class="keyword">throw</span> err;
    });
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>The validator is the object which is dispatched with the <code>run</code>
call from the <code>checkit.run</code> method.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> Runner = Checkit.Runner = <span class="keyword">function</span>(base) {
    <span class="keyword">this</span>.errors      = {};
    <span class="keyword">this</span>.base        = base;
    <span class="keyword">this</span>.validations = _.clone(base.validations);
    <span class="keyword">this</span>.conditional = base.conditional;
    <span class="keyword">this</span>.language    = Checkit.i18n[base.language || Checkit.language];
    <span class="keyword">this</span>.labelTransform = base.labelTransform || Checkit.labelTransform;
  };

  Runner.prototype = {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Runs the validations on a specified &quot;target&quot;.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    run: <span class="keyword">function</span>(target) {
      target = <span class="keyword">this</span>.target = _.clone(target || {});
      <span class="keyword">var</span> runner = <span class="keyword">this</span>, validations = <span class="keyword">this</span>.validations,
        errors = <span class="keyword">this</span>.errors,
        pending = [];

      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = <span class="keyword">this</span>.conditional.length; i &lt; l; i++) {
        pending.push(<span class="keyword">this</span>.checkConditional(<span class="keyword">this</span>.conditional[i]));
      }

      <span class="keyword">return</span> Checkit.Promise.all(pending).then(<span class="keyword">function</span>() {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Use a fresh &quot;pending&quot; stack.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> pending = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Loop through each of the <code>validations</code>, running
each of the validations associated with the <code>key</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> validations) {
          <span class="keyword">var</span> validation = validations[key];
          <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = validation.length; i &lt; l; i++) {
            pending.push(runner.processItem.call(runner, validation[i], key));
          }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Once all promise blocks have finished, we&#39;ll know whether
the promise should be rejected with an error or resolved with
the validated items.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">return</span> Checkit.Promise.all(pending).then(<span class="keyword">function</span>() {
          <span class="keyword">if</span> (!_.isEmpty(errors)) {
            <span class="keyword">var</span> err = <span class="keyword">new</span> CheckitError(_.keys(errors).length + <span class="string">' invalid values'</span>);
                err.errors = errors;
            <span class="keyword">throw</span> err;
          }
          <span class="keyword">return</span> _.pick.apply(_, [target].concat(_.keys(validations)));
        });

      });
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Runs through each of the <code>conditional</code> validations, and
merges them with the other validations if the condition passes;
either by returning <code>true</code> or a fulfilled promise.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    checkConditional: <span class="keyword">function</span>(conditional) {
      <span class="keyword">var</span> runner = <span class="keyword">this</span>, validations = <span class="keyword">this</span>.validations;
      <span class="keyword">return</span> Checkit.Promise.resolve(<span class="literal">true</span>).then(<span class="keyword">function</span>() {
        <span class="keyword">return</span> conditional[<span class="number">1</span>].call(runner, runner.target);
      }).then(<span class="keyword">function</span>(result) {</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Only if we explicitly return <code>true</code> do we go ahead
and add the validations to the stack for a particular rule.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> (result === <span class="literal">true</span>) {
          <span class="keyword">var</span> newVals = conditional[<span class="number">0</span>];
          <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> newVals) {
            validations[key] = validations[key] || [];
            validations[key] = validations[key].concat(newVals[key]);
          }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>We don&#39;t need to worry about thrown errors or failed promises,
because they&#39;re just a sign we&#39;re not supposed to run this rule.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      }, <span class="keyword">function</span>(err) {});
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Processes an individual item in the validation collection for the current
validation object. Returns the value from the completed validation, which will
be a boolean, or potentially a promise if the current object is an async validation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    processItem: <span class="keyword">function</span>(currentValidation, key) {
      <span class="keyword">var</span> result;
      <span class="keyword">var</span> runner  = <span class="keyword">this</span>, errors  = <span class="keyword">this</span>.errors;
      <span class="keyword">var</span> value   = <span class="keyword">this</span>.target[key];
      <span class="keyword">var</span> rule    = currentValidation.rule;
      <span class="keyword">var</span> params  = [value].concat(currentValidation.params);</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>If the rule isn&#39;t an existence / required check, return
true if the value doesn&#39;t exist.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (rule !== <span class="string">'accepted'</span> &amp;&amp; rule !== <span class="string">'exists'</span> &amp;&amp; rule !== <span class="string">'required'</span>) {
        <span class="keyword">if</span> (value === <span class="string">''</span> || value == <span class="literal">null</span>) <span class="keyword">return</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Create a fulfilled promise, so we can safely
run any function and not have a thrown error mess up our day.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">return</span> Checkit.Promise.resolve(<span class="literal">true</span>).then(<span class="keyword">function</span>() {
        <span class="keyword">if</span> (_.isFunction(rule)) {
          result = rule.apply(runner, params);
        } <span class="keyword">else</span> <span class="keyword">if</span> (Validators[rule]) {
          <span class="keyword">var</span> v = <span class="keyword">new</span> Validator(runner);
          result = v[rule].apply(v, params);
        } <span class="keyword">else</span> <span class="keyword">if</span> (_[rule]) {
          result = _[rule].apply(_, params);
        } <span class="keyword">else</span> <span class="keyword">if</span> (_[<span class="string">'is'</span> + capitalize(rule)]) {
          result = _[<span class="string">'is'</span> + capitalize(rule)].apply(_, params);
        } <span class="keyword">else</span> <span class="keyword">if</span> (regex[rule]) {
          result = regex[rule].test(value);
        } <span class="keyword">else</span> {
          <span class="keyword">var</span> valErr = <span class="keyword">new</span> ValidationError(<span class="string">'No validation defined for '</span> + rule);
              valErr.validationObject = currentValidation;
          <span class="keyword">throw</span> valErr;
        }
        <span class="keyword">return</span> result;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>If the promise is fulfilled, but the value is explicitly <code>false</code>,
it&#39;s a failed validation... throw it as a <code>Checkit.ValidationError</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      }).then(<span class="keyword">function</span>(result) {
        <span class="keyword">if</span> (_.isBoolean(result) &amp;&amp; result === <span class="literal">false</span>) {
          <span class="keyword">throw</span> <span class="keyword">new</span> ValidationError(runner.getMessage(currentValidation, key));
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Finally, catch any errors thrown from in the validation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      }).then(<span class="literal">null</span>, <span class="keyword">function</span>(err) {
        <span class="keyword">var</span> fieldError;
        <span class="keyword">if</span> (!(fieldError = errors[key])) {
          fieldError = errors[key] = <span class="keyword">new</span> FieldError(err);
          fieldError.key = key;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Attach the &quot;rule&quot; in case we want to reference it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        err.rule = rule;
        fieldError.errors.push(err);
      });
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Gets the formatted messaage for the validation error, depending
on what&#39;s passed and whatnot.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getMessage: <span class="keyword">function</span>(item, key) {
      <span class="keyword">var</span> base     = <span class="keyword">this</span>.base;
      <span class="keyword">var</span> language = <span class="keyword">this</span>.language;
      <span class="keyword">var</span> label    = item.label   || base.labels[key] || language.labels[key] || <span class="keyword">this</span>.labelTransform(key);
      <span class="keyword">var</span> message  = item.message || base.messages[item.rule] || language.messages[item.rule] || language.messages.fallback;
      message = message.replace(labelRegex, label);
      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = item.params.length; i &lt; l; i++) {
        message = message.replace(varRegex(i+<span class="number">1</span>), item.params[i]);
      }
      <span class="keyword">return</span> message;
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>All of the stock &quot;Validator&quot; functions
also attached as <code>Checkit.Validators</code> for easy access to add new validators.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> Validators = Checkit.Validators = {</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Check if the value is an &quot;accepted&quot; value, useful for form submissions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    accepted: <span class="keyword">function</span>(val) {
      <span class="keyword">return</span> _.contains(<span class="keyword">this</span>._language.accepted, val);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>The item must be a number between the given <code>min</code> and <code>max</code> values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    between: <span class="keyword">function</span>(val, min, max) {
      <span class="keyword">return</span> (<span class="keyword">this</span>.greaterThan(val, min) &amp;&amp;
        <span class="keyword">this</span>.lessThan(val, max));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Check that an item contains another item, either a string,
array, or object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    contains: <span class="keyword">function</span>(val, item) {
      <span class="keyword">if</span> (_.isString(val)) <span class="keyword">return</span> val.indexOf(item) !== -<span class="number">1</span>;
      <span class="keyword">if</span> (_.isArray(val))  <span class="keyword">return</span> _.indexOf(val, item) !== -<span class="number">1</span>;
      <span class="keyword">if</span> (_.isObject(val)) <span class="keyword">return</span> _.has(val, item);
      <span class="keyword">return</span> <span class="literal">false</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>The current value should be different than another field in the current
validation object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    different: <span class="keyword">function</span>(val, field) {
      <span class="keyword">return</span> !<span class="keyword">this</span>.matchesField(val, field);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Check if two items are the exact same length</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    exactLength: <span class="keyword">function</span>(val, length) {
      <span class="keyword">return</span> checkInt(length) || val.length === parseInt(length, <span class="number">10</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Key must not be <code>undefined</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    exists: <span class="keyword">function</span>(val) {
      <span class="keyword">return</span> val !== <span class="keyword">void</span> <span class="number">0</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Field is required and not empty (zero does not count as empty).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    required: <span class="keyword">function</span>(val) {
      <span class="keyword">return</span> (val != <span class="literal">null</span> &amp;&amp; val !== <span class="string">''</span> ? <span class="literal">true</span> : <span class="literal">false</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Matches another named field in the current validation object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    matchesField: <span class="keyword">function</span>(val, field) {
      <span class="keyword">return</span> _.isEqual(val, <span class="keyword">this</span>._target[field]);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Check that an item is a minimum length</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    minLength: <span class="keyword">function</span>(val, length) {
      <span class="keyword">return</span> checkInt(length) || val.length &gt;= length;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Check that an item is less than a length</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    maxLength: <span class="keyword">function</span>(val, length) {
      <span class="keyword">return</span> checkInt(length) || val.length &lt;= length;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Check if one items is greater than another</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    greaterThan: <span class="keyword">function</span>(val, param) {
      <span class="keyword">return</span> checkNumber(val) || checkNumber(param) || parseFloat(val) &gt; parseFloat(param);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Check if one items is greater than or equal to another</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    greaterThanEqualTo: <span class="keyword">function</span>(val, param) {
      <span class="keyword">return</span> checkNumber(val) || checkNumber(param) || parseFloat(val) &gt;= parseFloat(param);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Check if one item is less than another</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    lessThan: <span class="keyword">function</span>(val, param) {
      <span class="keyword">return</span> checkNumber(val) || checkNumber(param) || parseFloat(val) &lt; parseFloat(param);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Check if one item is less than or equal to another</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    lessThanEqualTo: <span class="keyword">function</span>(val, param) {
      <span class="keyword">return</span> checkNumber(val) || checkNumber(param) || parseFloat(val) &lt;= parseFloat(param);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Check if this item is a plain object, defaulting to the lodash check,
otherwise using a simple underscore fallback.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    isPlainObject: <span class="keyword">function</span>(val) {
      <span class="keyword">return</span> _.isPlainObject ? _.isPlainObject.apply(<span class="keyword">this</span>, arguments) :
        (_.isObject(val) &amp;&amp; !_.isFunction(val) &amp;&amp; !_.isArray(val));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Check if the value is numeric</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    isNumeric: <span class="keyword">function</span>(val) {
      <span class="keyword">return</span> !isNaN(parseFloat(val)) &amp;&amp; isFinite(val);
    }

  };</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Constructor for running the <code>Validations</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> Validator = Checkit.Validator = <span class="keyword">function</span>(runner) {
    <span class="keyword">this</span>._language = runner.language;
    <span class="keyword">this</span>._target   = runner.target;
  };
  Validator.prototype = Validators;</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Validation helpers &amp; regex</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">checkInt</span><span class="params">(val)</span> {</span>
    <span class="keyword">if</span> (!val.match(regex.integer))
      <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"The validator argument must be a valid integer"</span>);
  }

  <span class="function"><span class="keyword">function</span> <span class="title">checkNumber</span><span class="params">(val)</span> {</span>
    <span class="keyword">if</span> (!Validators.isNumeric(val))
      <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"The validator argument must be a valid number"</span>);
  }

  <span class="function"><span class="keyword">function</span> <span class="title">checkString</span><span class="params">(val)</span> {</span>
    <span class="keyword">if</span> (!_.isString(val))
      <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"The validator argument must be a valid string"</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Standard regular expression validators.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> regex = Checkit.regex = {
    alpha: <span class="regexp">/^[a-z]+$/i</span>,
    alphaDash: <span class="regexp">/^[a-z0-9_\-]+$/i</span>,
    alphaNumeric: <span class="regexp">/^[a-z0-9]+$/i</span>,
    alphaUnderscore: <span class="regexp">/^[a-z0-9_]+$/i</span>,
    base64: <span class="regexp">/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/</span>,
    email: <span class="regexp">/^[a-z0-9._%+\-]+@[a-z0-9.\-]+\.[a-z]{2,6}$/i</span>,
    integer: <span class="regexp">/^\-?[0-9]+$/</span>,
    ipv4: <span class="regexp">/^((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){3}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})$/i</span>,
    luhn: <span class="regexp">/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/</span>,
    natural: <span class="regexp">/^[0-9]+$/i</span>,
    naturalNonZero: <span class="regexp">/^[1-9][0-9]*$/i</span>,
    url: <span class="regexp">/^((http|https):\/\/(\w+:{0,1}\w*@)?(\S+)|)(:[0-9]+)?(\/|\/([\w#!:.?+=&amp;%@!\-\/]))?$/</span>,
    uuid: <span class="regexp">/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i</span>,
    hexadecimal: <span class="regexp">/^(0[x])?[0-9a-f]+$/i</span>
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>An error for an individual &quot;validation&quot;, where one or more &quot;validations&quot;
make up a single ruleset. These are grouped together into a <code>FieldError</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> ValidationError = Checkit.ValidationError = createError(<span class="string">'ValidationError'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>An <code>Error</code> object specific to an individual field,
useful in the <code>Checkit.check</code> method when you&#39;re only
validating an individual field. It contains an &quot;errors&quot;
array which keeps track of any falidations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> FieldError = Checkit.FieldError = createError(<span class="string">'FieldError'</span>, {errors: []});

  _.extend(FieldError.prototype, {</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Call <code>toString</code> on the current field, which should
turn the error into the format:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toString: <span class="keyword">function</span>(flat) {
      <span class="keyword">var</span> errors = flat ? [<span class="keyword">this</span>.errors[<span class="number">0</span>]] : <span class="keyword">this</span>.errors;
      <span class="keyword">return</span> <span class="keyword">this</span>.key + <span class="string">': '</span> +
        _.pluck(errors, <span class="string">'message'</span>).join(<span class="string">', '</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Returns the current error in json format, by calling <code>toJSON</code>
on the error, if there is one, otherwise returning the message.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toJSON: <span class="keyword">function</span>() {
      <span class="keyword">return</span> <span class="keyword">this</span>.map(<span class="keyword">function</span>(err) {
        <span class="keyword">if</span> (err.toJSON) <span class="keyword">return</span> err.toJSON();
        <span class="keyword">return</span> err.message;
      });
    }

  });</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>An object that inherits from the <code>Error</code> prototype,
but contains methods for working with the individual errors
created by the failed Checkit validation object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> CheckitError = Checkit.Error = createError(<span class="string">'CheckitError'</span>, {errors: {}});

  _.extend(CheckitError.prototype, {

    get: <span class="keyword">function</span>(name) {
      <span class="keyword">return</span> <span class="keyword">this</span>.errors[name];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Convert the current error object toString, by stringifying the JSON representation
of the object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toString: <span class="keyword">function</span>(flat) {
      <span class="keyword">return</span> <span class="string">'Checkit Errors - '</span> + <span class="keyword">this</span>.invoke(<span class="string">'toString'</span>, flat).join(<span class="string">'; '</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Creates a JSON object of the validations, if <code>true</code> is passed - it will
flatten the error into a single value per item.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toJSON: <span class="keyword">function</span>(flat) {
      <span class="keyword">return</span> <span class="keyword">this</span>.reduce(<span class="keyword">function</span>(memo, val, key) {
        memo[key] = val.toJSON();
        <span class="keyword">return</span> memo;
      }, {});
    }

  });</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Similar to a Backbone.js <code>Model</code> or <code>Collection</code>, we&#39;ll mixin the underscore
methods that make sense to act on <code>CheckitError.errors</code> or <code>FieldError.errors</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> objMethods   = [<span class="string">'keys'</span>, <span class="string">'values'</span>, <span class="string">'pairs'</span>, <span class="string">'invert'</span>, <span class="string">'pick'</span>, <span class="string">'omit'</span>];
  <span class="keyword">var</span> arrMethods   = [<span class="string">'first'</span>, <span class="string">'initial'</span>, <span class="string">'rest'</span>, <span class="string">'last'</span>];
  <span class="keyword">var</span> shareMethods = [<span class="string">'forEach'</span>, <span class="string">'each'</span>, <span class="string">'map'</span>, <span class="string">'reduce'</span>, <span class="string">'reduceRight'</span>,
    <span class="string">'find'</span>, <span class="string">'filter'</span>, <span class="string">'reject'</span>, <span class="string">'invoke'</span>, <span class="string">'toArray'</span>, <span class="string">'size'</span>, <span class="string">'shuffle'</span>];

  _.each(shareMethods.concat(objMethods), <span class="keyword">function</span>(method) {
    CheckitError.prototype[method] = <span class="keyword">function</span>() {
      <span class="keyword">return</span> _[method].apply(_, [<span class="keyword">this</span>.errors].concat(_.toArray(arguments)));
    };
  });
  _.each(shareMethods.concat(arrMethods), <span class="keyword">function</span>(method) {
    FieldError.prototype[method] = <span class="keyword">function</span>() {
      <span class="keyword">return</span> _[method].apply(_, [<span class="keyword">this</span>.errors].concat(_.toArray(arguments)));
    };
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Used to transform the label before using it, can be
set globally or in the <code>options</code> for the Checkit object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Checkit.labelTransform = <span class="keyword">function</span>(label) {
    <span class="keyword">return</span> label;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Object containing languages for the validations... Feel free to
add anything to this object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Checkit.i18n = {

    en: {

      accepted: [<span class="string">'on'</span>, <span class="string">'yes'</span>, <span class="number">1</span>, <span class="string">'1'</span>, <span class="literal">true</span>, <span class="string">'true'</span>],

      labels: {},

      messages: {</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Custom Predicates</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        email: <span class="string">'The {{label}} must be a valid email address'</span>,
        exactLength: <span class="string">'The {{label}} must be exactly {{var_1}} characters long'</span>,
        exists: <span class="string">'The {{label}} must be defined'</span>,
        required: <span class="string">'The {{label}} is required'</span>,
        minLength: <span class="string">'The {{label}} must be at least {{var_1}} characters long'</span>,
        maxLength: <span class="string">'The {{label}} must not exceed {{var_1}} characters long'</span>,
        lessThan: <span class="string">'The {{label}} must be a number less than {{var_1}}'</span>,
        lessThanEqualTo: <span class="string">'The {{label}} must be a number less than or equal to {{var_1}}'</span>,
        greaterThanEqualTo: <span class="string">'The {{label}} must be a number greater than or equal to {{var_1}}'</span>,
        numeric: <span class="string">'The {{label}} must be a numeric value'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Underscore Predicates</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        date: <span class="string">'The {{label}} must be a Date'</span>,
        equal: <span class="string">'The {{label}} does not match {{var_1}}'</span>,
        <span class="string">'boolean'</span>: <span class="string">'The {{label}} must be type "boolean"'</span>,
        empty: <span class="string">'The {{label}} must be empty'</span>,
        array: <span class="string">'The {{label}} must be an array'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Regex specific messages.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        alpha: <span class="string">'The {{label}} must only contain alphabetical characters'</span>,
        alphaDash: <span class="string">'The {{label}} must only contain alpha-numeric characters, underscores, and dashes'</span>,
        alphaNumeric: <span class="string">'The {{label}} must only contain alpha-numeric characters'</span>,
        alphaUnderscore: <span class="string">'The {{label}} must only contain alpha-numeric characters, underscores, and dashes'</span>,
        natural: <span class="string">'The {{label}} must be a positive number'</span>,
        naturalNonZero: <span class="string">'The {{label}} must be a number greater than zero'</span>,
        ipv4: <span class="string">'The {{label}} must be a valid IPv4 string'</span>,
        base64: <span class="string">'The {{label}} must be a base64 string'</span>,
        luhn: <span class="string">'The {{label}} must be a valid credit card number'</span>,
        uuid: <span class="string">'The {{label}} must be a valid uuid'</span>,
        hexadecimal: <span class="string">'The {{label}} must be a valid hexadecimal string'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>If there is no validation provided for an item, use this generic line.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        fallback: <span class="string">'Validation for {{label}} did not pass'</span>
      }
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <h2>Assorted Helper Items:</h2>

            </div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Regular expression for matching the <code>field_name</code> and <code>var_n</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> labelRegex = <span class="regexp">/\{\{label\}\}/g</span>;
  <span class="function"><span class="keyword">function</span> <span class="title">varRegex</span><span class="params">(i)</span> {</span> <span class="keyword">return</span> <span class="keyword">new</span> RegExp(<span class="string">'{{var_'</span> + i + <span class="string">'}}'</span>, <span class="string">'g'</span>); }</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Simple capitalize helper.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">capitalize</span><span class="params">(word)</span> {</span>
    <span class="keyword">return</span> word.charAt(<span class="number">0</span>).toUpperCase() + word.slice(<span class="number">1</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Preps the validations being sent to the <code>run</code> block, to standardize
the format and allow for maximum flexibility when passing to the
validation blocks.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">prepValidations</span><span class="params">(validations)</span> {</span>
    validations = _.clone(validations);
    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> validations) {
      <span class="keyword">var</span> validation = validations[key];
      <span class="keyword">if</span> (!_.isArray(validation)) validations[key] = validation = [validation];
      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = validation.length; i &lt; l; i++) {
        validation[i] = assembleValidation(validation[i]);
      }
    }
    <span class="keyword">return</span> validations;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Turns the current validation item into an object literal,
containing the rule, any arguments split from the <code>:</code> delimeter,
and the</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">assembleValidation</span><span class="params">(validation)</span> {</span>
    <span class="keyword">if</span> (!Validators.isPlainObject(validation)) {
      validation = {rule: validation, params: []};
    }
    <span class="keyword">if</span> (_.isString(validation.rule)) {
      <span class="keyword">var</span> splitRule = validation.rule.split(<span class="string">':'</span>);
      validation.rule = splitRule[<span class="number">0</span>];
      <span class="keyword">if</span> (_.isEmpty(validation.params)) {
        validation.params = _.rest(splitRule);
      }
    } <span class="keyword">else</span> <span class="keyword">if</span> (!_.isFunction(validation.rule)) {
      <span class="keyword">throw</span> <span class="keyword">new</span> TypeError(<span class="string">'Invalid validation'</span>);
    }
    <span class="keyword">return</span> validation;
  }

  Checkit.Promise = Promise;

  <span class="keyword">return</span> Checkit;
});</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Boilerplate UMD definition block...
get the correct dependencies and initialize everything.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>})(<span class="keyword">function</span>(checkitLib) {</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>AMD setup</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd) {
    define([<span class="string">'lodash'</span>, <span class="string">'create-error'</span>, <span class="string">'bluebird'</span>], checkitLib);</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>CJS setup</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> exports === <span class="string">'object'</span>) {
    module.exports = checkitLib(require(<span class="string">'lodash'</span>), require(<span class="string">'create-error'</span>), require(<span class="string">'bluebird'</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Browser globals</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  } <span class="keyword">else</span> {
    <span class="keyword">var</span> root = <span class="keyword">this</span>;
    <span class="keyword">var</span> Checkit = root.Checkit = checkitLib(root._, root.createError, root.Promise);
    Checkit.noConflict = <span class="keyword">function</span>() {
      root.checkit = lastCheckit;
      <span class="keyword">return</span> checkit;
    };
  }

});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
